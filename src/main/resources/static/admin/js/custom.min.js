$(function() {
    "use strict";
    $(function() {
        $(".preloader").fadeOut();
    }), jQuery(document).on("click", ".mega-dropdown", function(e) {
        e.stopPropagation();
    });
    var set = function() {
        (window.innerWidth > 0 ? window.innerWidth : this.screen.width) < 1170 ? ($("body").addClass("mini-sidebar"), 
        $(".navbar-brand span").hide(), $(".sidebartoggler i").addClass("ti-menu")) : ($("body").removeClass("mini-sidebar"), 
        $(".navbar-brand span").show());
        var height = (window.innerHeight > 0 ? window.innerHeight : this.screen.height) - 1;
        (height -= 0) < 1 && (height = 1), height > 0 && $(".page-wrapper").css("min-height", height + "px");
    };
    $(window).ready(set), $(window).on("resize", set), $(".sidebartoggler").on("click", function() {
        $("body").hasClass("mini-sidebar") ? ($("body").trigger("resize"), $("body").removeClass("mini-sidebar"), 
        $(".navbar-brand span").show()) : ($("body").trigger("resize"), $("body").addClass("mini-sidebar"), 
        $(".navbar-brand span").hide());
    }), $(".nav-toggler").click(function() {
        $("body").toggleClass("show-sidebar"), $(".nav-toggler i").toggleClass("ti-menu"), 
        $(".nav-toggler i").addClass("ti-close");
    }), $(".search-box a, .search-box .app-search .srh-btn").on("click", function() {
        $(".app-search").toggle(200);
    }), $(".right-side-toggle").click(function() {
        $(".right-sidebar").slideDown(50), $(".right-sidebar").toggleClass("shw-rside");
    }), $(".floating-labels .form-control").on("focus blur", function(e) {
        $(this).parents(".form-group").toggleClass("focused", "focus" === e.type || this.value.length > 0);
    }).trigger("blur"), $(function() {
        for (var url = window.location, element = $("ul#sidebarnav a").filter(function() {
            return this.href == url;
        }).addClass("active").parent().addClass("active"); ;) {
            if (!element.is("li")) break;
            element = element.parent().addClass("in").parent().addClass("active");
        }
    }), $(function() {
        $('[data-toggle="tooltip"]').tooltip();
    }), $(function() {
        $('[data-toggle="popover"]').popover();
    }), $(function() {
        $("#sidebarnav").AdminMenu();
    }), $(".scroll-sidebar, .right-side-panel, .message-center, .right-sidebar").perfectScrollbar(), 
    $("body").trigger("resize"), $(".list-task li label").click(function() {
        $(this).toggleClass("task-done");
    }), $('a[data-action="collapse"]').on("click", function(e) {
        e.preventDefault(), $(this).closest(".card").find('[data-action="collapse"] i').toggleClass("ti-minus ti-plus"), 
        $(this).closest(".card").children(".card-body").collapse("toggle");
    }), $('a[data-action="expand"]').on("click", function(e) {
        e.preventDefault(), $(this).closest(".card").find('[data-action="expand"] i').toggleClass("mdi-arrow-expand mdi-arrow-compress"), 
        $(this).closest(".card").toggleClass("card-fullscreen");
    }), $('a[data-action="close"]').on("click", function() {
        $(this).closest(".card").removeClass().slideUp("fast");
    });
    //列表分页
    //perPage 每一页显示条数     current：当前第几页
    function pagination(perPage,current) {
        alert("skksk");
        var tableData = document.getElementById("searchList");
        var totalCount=tableData.rows.length;  //总条数

        //设置表格总页数
        var totalPage=0;//列表的总页数
        var pageSize = perPage;
        if (totalCount/pageSize > parseInt(totalCount/pageSize)){
            totalPage = parseInt(totalCount/pageSize)+1;
        }else{
            totalPage = parseInt(totalCount/pageSize);
        }
        //对数据进行分页
        var currentPage=current;
        var startRow=(currentPage-1)*pageSize+1;
        var endRow=(currentPage*pageSize > totalCount ? totalCount : currentPage*pageSize);

        for(var i=1;i<(totalCount+1);i++){
            var irow = tableData.rows[i-1];
            if(i>=startRow && i<=endRow){
                irow.style.display = "block";
            }else{
                irow.style.display = "none";
            }
        }
        //位置2 生成当前的点击按钮
        createBtns(totalPage , current);
        //位置3  绑定点击事件
        bindClick(totalPage);

    };
    //生成点击按钮
    //totalPages 分页的总页数
    //current当前页
    function createBtns(totalPages , current) {
        var tempStr = "";
        /*上一页按钮*/
        if (current > 1) {
            /* tempStr += "<span class='btn first' href=\"#\"  data-page = '1'>首页</span>";*/
            tempStr += "<span class='btn prev' href=\"#\" data-page = "+(current-1)+">上一页</span>"
        }
        /*中间页码的显示*/
        /*如果总页数超出5个处理办法*/
        if(totalPages<=5){
            for(var pageIndex= 1 ; pageIndex < totalPages+1; pageIndex++){
                tempStr += "<a  class='btn page"+pageIndex+"'  data-page = "+( pageIndex )+"><span>"+ pageIndex +"</span></a>";
            }
        }else{
            if(current<5){
                for(var pageIndex= 1 ; pageIndex < 5; pageIndex++){
                    tempStr += "<a  class='btn page"+pageIndex+"'  data-page = "+( pageIndex )+"><span>"+ pageIndex +"</span></a>";
                }
                tempStr+='<span>......</span>';
                tempStr += "<a  class='btn page"+totalPages+"'  data-page = "+( totalPages )+"><span>"+ totalPages +"</span></a>";
            }else if(current>= totalPages-4){
                tempStr += "<a  class='btn page"+1+"'  data-page = "+( 1 )+"><span>"+ 1 +"</span></a>";
                tempStr+='<span>......</span>';
                for(var pageIndex= totalPages-4 ; pageIndex <= totalPages; pageIndex++){
                    tempStr += "<a  class='btn page"+pageIndex+"'  data-page = "+( pageIndex )+"><span>"+ pageIndex +"</span></a>";
                }
            }else if(current>=5 && current <totalPages-4){
                tempStr += "<a  class='btn page"+1+"'  data-page = "+( 1 )+"><span>"+ 1 +"</span></a>";
                tempStr+='<span>......</span>';
                for(var pageIndex= current ; pageIndex <= current+4; pageIndex++){
                    tempStr += "<a  class='btn page"+pageIndex+"'  data-page = "+( pageIndex )+"><span>"+ pageIndex +"</span></a>";
                }
                tempStr+='<span>......</span>';
                tempStr += "<a  class='btn page"+totalPages+"'  data-page = "+( totalPages )+"><span>"+ totalPages +"</span></a>";
            }
        }
        /*下一页按钮*/
        if (current < totalPages) {
            tempStr += "<span class='btn next' href=\"#\"  data-page = "+(current+1)+">下一页</span>";
            /*            tempStr += "<span class='btn last' href=\"#\" data-page = "+ (totalPages) +">尾页</span>";*/
        }
        document.getElementById("pageination").innerHTML = tempStr;
    };
    function bindClick(totalPage) {
        // 设置首页、末页、上一页、下一页的点击事件
        var buttonArr = ['first','last','prev','next'];
        for(var k in buttonArr){
            var $dom = '.'+buttonArr[k];
            $('body').delegate( $dom , 'click' , function () {
                var data = $(this).data('page');//获取当前按钮跳转的页数
                pagination('3' , data);//对页面进行分页
                //对当前页码的样式做处理
                $('.page'+data).css({background:'#0449d4',color:'#fff'}).siblings().css({background:'#fff',color:'#999'});
            })
        }

        // 设置数码的点击事件 totalImgPage是总页数，为全局变量，在分页时被赋值
        for (var k  = 1 ;k <= totalPage ; k++){
            var $singleDom  = '.page'+k;
            $('body').delegate( $singleDom , 'click' , function () {
                var data = $(this).data('page');
                pagination('3' , data);//对页面进行分页
                //对当前页码的样式做处理
                $('.page'+data).css({background:'#0449d4',color:'#fff'}).siblings().css({background:'#fff',color:'#999'});
            })
        }
    };
});